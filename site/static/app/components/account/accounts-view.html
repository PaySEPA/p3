<div class="section section-accounts">
  <headline-menu headline="Accounts" loading="model.state.accounts.loading">
    <ul class="stackable-menu dropdown-menu">
      <li>
        <a class="stackable-cancel" ng-click="model.modals.showAddAccount=true"><i class="fa fa-plus"></i> Add Account</a>
      </li>
    </ul>
  </headline-menu>
  <table class="table table-condensed" ng-show="!model.state.accounts.loading && model.accounts.length > 0">
    <thead>
      <tr>
        <th class="name">Account</th>
        <th class="money">Balance</th>
        <th class="action">Action</th>
      </tr>
    </thead>
    <!-- FIXME: use ng-repeat-start/ng-repeat-end on tr once using AngularJS 1.2 -->
    <tbody ng-repeat="account in model.accounts | orderBy:'label'" class="account" style="border: none">
      <tr>
        <!-- Label -->
        <td class="name">
          <a href="{{account.id}}">{{account.label}}</a>
          <span ng-show="account.sysStatus != 'active'" class="disabled">(Disabled)</span>
          <span ng-show="model.identity.preferences.source == account.id"
            data-tooltip-title="This is the default account."
            data-placement="bottom" data-trigger="hover"><i class="icon fa fa-star"></i></span>
          <span ng-show="(account.creditLimit && util.parseFloat(account.creditLimit) != 0) && (!account.backupSource || !account.backupSource.length)"
            data-tooltip-title="This account has no associated payment methods. Please edit the account information."
            data-placement="bottom" data-trigger="hover"><i class="icon fa fa-exclamation-triangle"></i></span>
          <span ng-show="account.showExpirationWarning"
            data-tooltip-title="This account uses a payment method that will expire soon."
            data-placement="bottom" data-trigger="hover"><i class="icon fa fa-exclamation-triangle"></i></span>
          <span ng-show="account.showExpired"
            data-tooltip-title="This account uses an expired payment method."
            data-placement="bottom" data-trigger="hover"><i class="icon fa fa-exclamation-triangle"></i></span>
        </td>
        <!-- Balance -->
        <td class="money">
          <div data-account-balance-summary="account" data-expand="model.expandAccountBalance[account.id]"></div>
        </td>
        <!-- Action -->
        <td class="action">
          <action-menu>
            <ul class="dropdown-menu stackable-menu">
              <li ng-show="model.identity.preferences.source != account.id">
                <a class="stackable-cancel" ng-click="model.setDefaultAccount(account)">
                  <i class="fa fa-star"></i> Set as Default
                </a>
              </li>
              <li>
                <a class="stackable-cancel" ng-click="model.modals.account=account; model.modals.showDeposit=true">
                  <i class="fa fa-plus"></i> Deposit
                </a>
              </li>
              <li ng-class="{disabled: account.balance == 0}">
                <a ng-show="account.balance == 0" href="#">
                  <i class="fa fa-minus"></i> Withdraw
                </a>
                <a class="stackable-cancel" ng-hide="account.balance == 0" ng-click="model.modals.account=account; model.modals.showWithdraw=true">
                  <i class="fa fa-minus"></i> Withdraw
                </a>
              </li>
              <li>
                <a class="stackable-cancel" ng-click="model.modals.account=account; model.modals.showEditAccount=true">
                  <i class="fa fa-pencil"></i> Edit
                </a>
              </li>
              <li ng-show="model.identity.sysUnbackedCreditEmailAvailable && (!account.creditLimit || account.creditLimit == 0)">
                <a class="stackable-cancel" ng-click="model.modals.account=account; model.modals.showAddCreditLine=true">
                  <i class="fa fa-credit-card"></i> Open Credit Line
                </a>
              </li>
              <li>
                <a class="stackable-cancel" ng-click="model.modals.account=account; model.modals.showRedeemPromoCode=true">
                  <i class="fa fa-money"></i> Redeem Promo Code
                </a>
              </li>
            </ul>
          </action-menu>
        </td>
      </tr>
      <tr>
        <td colspan="3" style="border: none; padding-top: 0; padding-bottom: {{model.expandAccountBalance[account.id] && '4px' || '0'}}">
          <div data-account-balance-details="account" data-expand="model.expandAccountBalance[account.id]"></div>
        </td>
      </tr>
    </tbody>
  </table>
  <div ng-show="!model.state.accounts.loading && model.accounts.length == 0">
    <p class="center">You have no accounts for this identity.</p>
  </div>
  <stackable-modal stackable="model.modals.showDeposit">
    <div data-deposit-modal data-account="model.modals.account" data-instant="false"></div>
  </stackable-modal>
  <stackable-modal stackable="model.modals.showWithdraw">
    <div data-withdraw-modal data-account="model.modals.account"></div>
  </stackable-modal>
  <stackable-modal stackable="model.modals.showEditAccount">
    <div data-edit-account-modal data-account="model.modals.account"></div>
  </stackable-modal>
  <stackable-modal stackable="model.modals.showAddAccount">
    <div data-add-account-modal></div>
  </stackable-modal>
  <stackable-modal stackable="model.modals.showAddCreditLine">
    <div data-add-credit-line-modal data-account="model.modals.account"></div>
  </stackable-modal>
  <stackable-modal stackable="model.modals.showRedeemPromoCode">
    <div data-redeem-promo-code-modal data-account="model.modals.account"></div>
  </stackable-modal>
</div>
