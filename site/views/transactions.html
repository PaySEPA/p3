{% extends 'layout.html' %}

{% set pageTitle = "Transaction Activity" %}

{% block content %}

{% raw %}
<div data-ng-controller="ActivityCtrl as model" class="ng-cloak">

<ul class="breadcrumb" data-ng-show="model.identity.id == model.account.owner">
  <li>
    <a href="{{model.identity.id}}/dashboard">Dashboard ({{model.identity.label}}) </a> <span class="divider">/</span>
  </li>
  <li>
    Accounts <span class="divider" ng-show="model.account">/</span>
  </li>
  <li class="active">
    {{model.account.label}}
  </li>
</ul>

<ul class="breadcrumb" data-ng-show="!model.session.auth && model.account.label">
  <li>
    <a href="{{model.account.owner}}">Account Owner</a> <span class="divider">/</span>
  </li>
  <li>
    Accounts <span class="divider" ng-show="model.account">/</span>
  </li>
  <li>{{model.account.label}}</li>
</ul>

<h2 class="headline">Account Activity at or before {{model.startDate | date:'medium'}}</h2>

<table class="table table-condensed">
  <tbody>
    <tr data-ng-show="model.account">
      <td class="compact">Balance</td>
      <td>
        <div data-account-balance-summary="model.account" data-expand="model.expandAccountBalance"></div>
      </td>
    </tr>
    <tr>
      <td colspan="2" style="border: none; padding-top: 0; padding-bottom: {{(model.expandAccountBalance && '5px') || '0'}}">
        <div data-account-balance-details="model.account" data-expand="model.expandAccountBalance"></div>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <span>Showing {{model.txns.length}}
          <span data-ng-pluralize="" data-count="model.txns.length"
            data-when="{'1': 'transaction', 'other': 'transactions'}"></span>
        </span>
      </td>
    </tr>
  </tbody>
</table>

<div class="well account-activity-well">
  <form class="form-horizontal account-activity-form" action="">
    <fieldset>
      <div class="control-group">
        <label class="control-label" for="dateField">Start Date</label>
        <div class="controls">
          <input name="dateField" type="text"
            data-ng-model="model.datePickerDate"
            data-datepicker-popup="yyyy/MM/dd" data-ng-change="model.dateChanged()"
            data-is-open="model.datePickerOpen"
            data-ui-keyup="{'enter esc': 'model.dateQuitKeyPressed($event)'}" />
          <button class="btn" ng-click="model.openDatePicker()"><i class="icon-calendar"></i></button>
        </div>
      </div>
    </fieldset>
  </form>
</div>

<table class="table table-hover table-condensed"
  data-ng-show="model.txns.state.loading || model.txns.storage.length > 0">
  <thead>
    <tr>
      <th class="date">Date</th>
      <th class="name">Item</th>
      <th class="money">Amount</th>
    </tr>
  </thead>
  <tbody>
    <tr data-ng-repeat="row in model.table"
      data-ng-class="(model.getRowType(row) != 'transfer' && !row.settled && !row.voided && 'info') || (model.getRowType(row) == 'transfer' && !row.txn.settled && !row.txn.voided && 'info') || (row.voided && 'error')"
      data-ng-hide="row.hidden"
      data-ng-click="model.toggleDetails(row)">
      <!-- Date -->
      <td data-ng-switch="model.getRowType(row)" style="max-width: 150px;">
        <span data-ng-switch-when="deposit" class="date">{{row.created | date:'medium'}}</span>
        <span data-ng-switch-when="contract" class="date">{{row.created | date:'medium'}}</span>
        <span data-ng-switch-when="withdrawal" class="date">{{row.created | date:'medium'}}</span>
        <span data-ng-switch-when="transfer">&nbsp;</span>
      </td>
      <!-- Item -->
      <td data-ng-switch="model.getRowType(row)">
        <span data-ng-switch-when="deposit" class="name"><i class="icon-plus"></i> Deposit <span data-ng-show="!(row.settled || row.voided)" class="label label-info">Pending</span><span data-ng-show="row.voided" class="label label-important">Voided</span><div data-ng-show="row.detailsVisible"><a href="{{row.id}}"><i class="icon-list-alt"></i> View detailed deposit...</a></div></span>
        <span data-ng-switch-when="contract" class="name"><i class="icon-shopping-cart"></i> {{row.asset.title}} <span data-ng-show="!(row.settled || row.voided)" class="label label-info">Pending</span><span data-ng-show="row.voided" class="label label-important">Voided</span><div data-ng-show="row.detailsVisible"><a href="{{row.id}}"><i class="icon-list-alt"></i> View detailed receipt...</a></div></span>
        <span data-ng-switch-when="withdrawal" class="name"><i class="icon-minus"></i> Withdrawal <span data-ng-show="!(row.settled || row.voided)" class="label label-info">Pending</span><span data-ng-show="row.voided" class="label label-important">Voided</span><div data-ng-show="row.detailsVisible"><a href="{{row.id}}"><i class="icon-list-alt"></i> View detailed withdrawal...</a></div></span>
        <span data-ng-switch-when="transfer">
          <i class="icon-info-sign" title="Details"></i> {{row.comment}}<br/>
          <i class="icon-minus" title="Source Account"></i> <a data-ng-show="row.sourceLink" href="{{row.source}}">{{row.source}}</a><span data-ng-hide="row.sourceLink">{{row.source}}</span> <br/>
          <i class="icon-plus" title="Destination Account"></i> <a data-ng-show="row.destinationLink" href="{{row.destination}}">{{row.destination}}</a><span data-ng-hide="row.destinationLink">{{row.destination}}</span>
        </span>
      </td>
      <!-- Amount -->
      <td class="money">
        <span class="money" data-tooltip-title="Since we support micro-payments, we track transaction amounts very accurately. The exact amount of this transaction is USD {{row.amount}}."
          data-placement="bottom" data-trigger="hover"><span class="currency">USD</span> {{row.amount | ceil | currency:'$'}}</span>
      </td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="3" style="text-align: center">
        <span class="center">
          <button data-ng-hide="model.txns.state.loading" class="btn"
            data-ng-click="model.getMore()"><i class="icon-list"></i> More <i class="icon-chevron-right"></i></button>
          <span data-spinner="model.txns.state.loading"
            data-spinner-class="table-spinner"></span>
        </span>
      </td>
    </tr>
    <tr>
      <td colspan="3"><p class="alert alert-info micropayment-note">PaySwarm uses a micro-accounting system that is accurate to 10 monetary digits.<br />Using your mouse, hover over an individual amount to see its exact value.</p></td>
    </tr>
  </tfoot>
</table>

<div data-ng-show="!model.txns.state.loading && txns.storage.length == 0">
  <h2 class="center">No Transactions</h2>
  <p class="center">There are no transactions recorded for this account before the given date.</p>
</div>

</div>
{% endraw %}

{% endblock %}
